<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang=""><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/><title>AddressMenuBar.java</title><link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">view</a> &gt; <a href="index.source.html" class="el_package">com.jsql.view.swing.panel.address</a> &gt; <span class="el_source">AddressMenuBar.java</span></div><h1>AddressMenuBar.java</h1><pre class="source lang-java linenums">package com.jsql.view.swing.panel.address;

import com.jsql.model.injection.strategy.AbstractStrategy;
import com.jsql.model.injection.strategy.StrategyInjectionError;
import com.jsql.model.injection.vendor.model.Vendor;
import com.jsql.model.injection.vendor.model.yaml.Method;
import com.jsql.util.I18nUtil;
import com.jsql.util.LogLevelUtil;
import com.jsql.view.swing.manager.util.ComboMenu;
import com.jsql.view.swing.panel.PanelAddressBar;
import com.jsql.view.swing.panel.util.ButtonAddressBar;
import com.jsql.view.swing.text.JToolTipI18n;
import com.jsql.view.swing.ui.ComponentBorder;
import com.jsql.view.swing.util.I18nViewUtil;
import com.jsql.view.swing.util.MediatorHelper;
import com.jsql.view.swing.util.UiUtil;
import org.apache.logging.log4j.LogManager;
import org.apache.logging.log4j.Logger;

import javax.swing.*;
import java.awt.*;
import java.util.Arrays;
import java.util.Locale;

public class AddressMenuBar extends JMenuBar {
    
    /**
     * Log4j logger sent to view.
     */
<span class="fc" id="L30">    private static final Logger LOGGER = LogManager.getRootLogger();</span>

<span class="fc" id="L32">    private JMenu itemRadioStrategyError = new JMenu();</span>

    private final JMenu menuVendor;
    private final JMenu menuStrategy;
<span class="fc" id="L36">    private final ButtonGroup groupStrategy = new ButtonGroup();</span>

    /**
     * Animated GIF displayed during injection.
     */
<span class="fc" id="L41">    private final JLabel loader = new JLabel(UiUtil.ICON_LOADER_GIF);</span>

    /**
     * Connection button.
     */
<span class="fc" id="L46">    private final ButtonAddressBar buttonInUrl = new ButtonAddressBar();</span>
    
<span class="fc" id="L48">    public AddressMenuBar(PanelAddressBar panelAddressBar) {</span>
        
<span class="fc" id="L50">        this.buttonInUrl.setName(&quot;buttonInUrl&quot;);</span>
<span class="fc" id="L51">        this.buttonInUrl.setToolTipText(I18nUtil.valueByKey(&quot;BUTTON_START_TOOLTIP&quot;));</span>
<span class="fc" id="L52">        this.buttonInUrl.addActionListener(new ActionStart(panelAddressBar));</span>

<span class="fc" id="L54">        var buttonInTextfield = new ComponentBorder(this.buttonInUrl, 17, 0);</span>
<span class="fc" id="L55">        buttonInTextfield.install(panelAddressBar.getTextFieldAddress());</span>
        
<span class="fc" id="L57">        this.setOpaque(false);</span>
<span class="fc" id="L58">        this.setBorder(null);</span>

<span class="fc" id="L60">        this.menuStrategy = new ComboMenu(&quot;Strategy auto&quot;);</span>
<span class="fc" id="L61">        this.menuStrategy.setName(&quot;menuStrategy&quot;);</span>
        
<span class="fc" id="L63">        final var patternKeyTooltipStrategy = &quot;STRATEGY_%s_TOOLTIP&quot;;</span>

<span class="fc bfc" id="L65" title="All 2 branches covered.">        for (final AbstractStrategy strategy: MediatorHelper.model().getMediatorStrategy().getStrategies()) {</span>
            
            JMenuItem itemRadioStrategy;

<span class="fc bfc" id="L69" title="All 2 branches covered.">            if (strategy == MediatorHelper.model().getMediatorStrategy().getError()) {</span>
                
<span class="fc" id="L71">                itemRadioStrategy = new JMenu(strategy.toString());</span>
<span class="fc" id="L72">                this.itemRadioStrategyError = (JMenu) itemRadioStrategy;</span>
<span class="fc" id="L73">                itemRadioStrategy.getComponent().setName(&quot;itemRadioStrategyError&quot;);</span>
                
            } else {
                
<span class="fc" id="L77">                final var refTooltip = new JToolTipI18n[] {</span>
                        
                    new JToolTipI18n(
<span class="fc" id="L80">                        I18nUtil.valueByKey(</span>
<span class="fc" id="L81">                            String.format(</span>
                                patternKeyTooltipStrategy,
<span class="fc" id="L83">                                strategy.getName().toUpperCase(Locale.ROOT)</span>
                            )
                        )
                    )
                };
                
<span class="fc" id="L89">                itemRadioStrategy = new JRadioButtonMenuItem(strategy.toString()) {</span>
                    
                    @Override
                    public JToolTip createToolTip() {
                        
<span class="nc" id="L94">                        JToolTipI18n tipI18n = new JToolTipI18n(</span>
<span class="nc" id="L95">                            I18nUtil.valueByKey(</span>
<span class="nc" id="L96">                                String.format(</span>
                                    patternKeyTooltipStrategy,
<span class="nc" id="L98">                                    strategy.getName().toUpperCase(Locale.ROOT)</span>
                                )
                            )
                        );
                        
<span class="nc" id="L103">                        refTooltip[0] = tipI18n;</span>
                        
<span class="nc" id="L105">                        return tipI18n;</span>
                    }
                };
                
<span class="fc" id="L109">                I18nViewUtil.addComponentForKey(</span>
<span class="fc" id="L110">                    String.format(</span>
                        patternKeyTooltipStrategy,
<span class="fc" id="L112">                        strategy.getName().toUpperCase(Locale.ROOT)</span>
                    ),
                    refTooltip[0]
                );

<span class="fc" id="L117">                itemRadioStrategy.getComponent().setName(&quot;itemRadioStrategy&quot;+ strategy);</span>
                
<span class="fc" id="L119">                itemRadioStrategy.addActionListener(actionEvent -&gt; {</span>
                    
<span class="nc" id="L121">                    this.menuStrategy.setText(strategy.toString());</span>
<span class="nc" id="L122">                    MediatorHelper.model().getMediatorStrategy().setStrategy(strategy);</span>
<span class="nc" id="L123">                });</span>
                
<span class="fc" id="L125">                this.groupStrategy.add(itemRadioStrategy);</span>
            }

<span class="fc" id="L128">            this.menuStrategy.add(itemRadioStrategy);</span>
            
<span class="fc" id="L130">            itemRadioStrategy.setToolTipText(</span>
<span class="fc" id="L131">                I18nUtil.valueByKey(</span>
<span class="fc" id="L132">                    String.format(</span>
                        patternKeyTooltipStrategy,
<span class="fc" id="L134">                        strategy.getName().toUpperCase(Locale.ROOT)</span>
                    )
                )
            );
<span class="fc" id="L138">            ((JComponent) itemRadioStrategy).setEnabled(false);</span>
<span class="fc" id="L139">        }</span>

<span class="fc" id="L141">        this.menuVendor = new ComboMenu(MediatorHelper.model().getMediatorVendor().getAuto().toString());</span>
<span class="fc" id="L142">        this.menuVendor.setName(&quot;menuVendor&quot;);</span>
<span class="fc" id="L143">        this.menuVendor.getPopupMenu().setLayout(new GridLayout((MediatorHelper.model().getMediatorVendor().getVendors().size() + 1) / 2, 2));</span>

<span class="fc" id="L145">        var groupVendor = new ButtonGroup();</span>

<span class="fc bfc" id="L147" title="All 2 branches covered.">        for (final Vendor vendor: MediatorHelper.model().getMediatorVendor().getVendors()) {</span>
            
<span class="fc bfc" id="L149" title="All 2 branches covered.">            JMenuItem itemRadioVendor = new JRadioButtonMenuItem(vendor.toString(), vendor == MediatorHelper.model().getMediatorVendor().getAuto());</span>
<span class="fc" id="L150">            itemRadioVendor.setName(&quot;itemRadioVendor&quot;+ vendor);</span>
<span class="fc" id="L151">            itemRadioVendor.addActionListener(actionEvent -&gt; {</span>
                
<span class="nc" id="L153">                this.menuVendor.setText(vendor.toString());</span>
<span class="nc" id="L154">                MediatorHelper.model().getMediatorVendor().setVendorByUser(vendor);</span>
<span class="nc" id="L155">            });</span>
            
<span class="fc" id="L157">            this.menuVendor.add(itemRadioVendor);</span>
<span class="fc" id="L158">            groupVendor.add(itemRadioVendor);</span>
<span class="fc" id="L159">        }</span>

<span class="fc" id="L161">        this.add(Box.createHorizontalGlue());</span>
<span class="fc" id="L162">        this.add(this.loader);</span>
<span class="fc" id="L163">        this.add(Box.createHorizontalStrut(5));</span>
<span class="fc" id="L164">        this.add(this.menuVendor);</span>
<span class="fc" id="L165">        this.add(this.menuStrategy);</span>

<span class="fc" id="L167">        this.loader.setVisible(false);</span>
<span class="fc" id="L168">        this.loader.setCursor(Cursor.getPredefinedCursor(Cursor.TEXT_CURSOR));</span>
<span class="fc" id="L169">    }</span>

    public void endPreparation() {
        
<span class="fc" id="L173">        this.buttonInUrl.setToolTipText(I18nUtil.valueByKey(&quot;BUTTON_START_TOOLTIP&quot;));</span>
<span class="fc" id="L174">        this.buttonInUrl.setInjectionReady();</span>
<span class="fc" id="L175">        this.loader.setVisible(false);</span>
<span class="fc" id="L176">    }</span>
    
    public void initErrorMethods(Vendor vendor) {
        
<span class="fc" id="L180">        this.itemRadioStrategyError.removeAll();</span>

<span class="fc" id="L182">        var indexError = 0;</span>
        
<span class="fc" id="L184">        if (</span>
<span class="pc bpc" id="L185" title="1 of 2 branches missed.">            vendor != MediatorHelper.model().getMediatorVendor().getAuto()</span>
<span class="pc bpc" id="L186" title="1 of 2 branches missed.">            &amp;&amp; vendor.instance().getModelYaml().getStrategy().getError() != null</span>
        ) {
            
<span class="fc bfc" id="L189" title="All 2 branches covered.">            for (Method methodError: vendor.instance().getModelYaml().getStrategy().getError().getMethod()) {</span>
                
<span class="fc" id="L191">                JMenuItem itemRadioVendor = new JRadioButtonMenuItem(methodError.getName());</span>
<span class="fc" id="L192">                itemRadioVendor.setEnabled(false);</span>
<span class="fc" id="L193">                itemRadioVendor.setName(&quot;itemRadioVendor&quot;+ methodError.getName());</span>
                
<span class="fc" id="L195">                this.itemRadioStrategyError.add(itemRadioVendor);</span>
<span class="fc" id="L196">                this.groupStrategy.add(itemRadioVendor);</span>

<span class="fc" id="L198">                int indexErrorFinal = indexError;</span>
                
<span class="fc" id="L200">                itemRadioVendor.addActionListener(actionEvent -&gt; {</span>
                    
<span class="fc" id="L202">                    this.menuStrategy.setText(methodError.getName());</span>
<span class="fc" id="L203">                    MediatorHelper.model().getMediatorStrategy().setStrategy(MediatorHelper.model().getMediatorStrategy().getError());</span>
<span class="fc" id="L204">                    MediatorHelper.model().getMediatorStrategy().getError().setIndexErrorStrategy(indexErrorFinal);</span>
<span class="fc" id="L205">                });</span>

<span class="fc" id="L207">                indexError++;</span>
<span class="fc" id="L208">            }</span>
        }
<span class="fc" id="L210">    }</span>
    
    public void reset() {
        
<span class="pc bpc" id="L214" title="1 of 2 branches missed.">        if (MediatorHelper.model().getMediatorVendor().getVendorByUser() == MediatorHelper.model().getMediatorVendor().getAuto()) {</span>
<span class="fc" id="L215">            this.menuVendor.setText(MediatorHelper.model().getMediatorVendor().getAuto().toString());</span>
        }
        
<span class="fc" id="L218">        this.menuStrategy.setText(&quot;Strategy auto&quot;);</span>
        
<span class="fc bfc" id="L220" title="All 2 branches covered.">        for (var i = 0 ; i &lt; this.menuStrategy.getItemCount() ; i++) {</span>
<span class="fc" id="L221">            this.menuStrategy.getItem(i).setEnabled(false);</span>
        }
        
<span class="fc" id="L224">        this.getMenuError().removeAll();</span>
<span class="fc" id="L225">        this.groupStrategy.clearSelection();</span>
<span class="fc" id="L226">    }</span>
    
    public void setVendor(Vendor vendor) {
        
<span class="fc" id="L230">        this.menuVendor.setText(vendor.toString());</span>
<span class="fc" id="L231">        this.initErrorMethods(vendor);</span>
<span class="fc" id="L232">    }</span>
    
    public void resetLabelStrategy() {
<span class="nc bnc" id="L235" title="All 2 branches missed.">        for (var i = 0 ; i &lt; this.menuStrategy.getItemCount() ; i++) {</span>
            
<span class="nc" id="L237">            this.menuStrategy.getItem(i).setEnabled(false);</span>
<span class="nc" id="L238">            this.menuStrategy.getItem(i).setSelected(false);</span>
        }
<span class="nc" id="L240">    }</span>
    
    public void markStrategy(AbstractStrategy strategy) {
        
<span class="nc" id="L244">        this.menuStrategy.setText(strategy.toString());</span>
        
<span class="nc bnc" id="L246" title="All 2 branches missed.">        for (var i = 0 ; i &lt; this.menuStrategy.getItemCount() ; i++) {</span>
<span class="nc bnc" id="L247" title="All 2 branches missed.">            if (this.menuStrategy.getItem(i).getText().equals(strategy.toString())) {</span>
                
<span class="nc" id="L249">                this.menuStrategy.getItem(i).setSelected(true);</span>
<span class="nc" id="L250">                break;</span>
            }
        }
<span class="nc" id="L253">    }</span>
    
    public void markStrategyInvulnerable(AbstractStrategy strategy) {
<span class="nc bnc" id="L256" title="All 2 branches missed.">        for (var i = 0 ; i &lt; this.menuStrategy.getItemCount() ; i++) {</span>
<span class="nc bnc" id="L257" title="All 2 branches missed.">            if (this.menuStrategy.getItem(i).getText().equals(strategy.toString())) {</span>
                
<span class="nc" id="L259">                this.menuStrategy.getItem(i).setEnabled(false);</span>
<span class="nc" id="L260">                break;</span>
            }
        }
<span class="nc" id="L263">    }</span>
    
    public void markErrorInvulnerable(int indexMethodError) {
        
<span class="nc" id="L267">        AbstractStrategy strategy = MediatorHelper.model().getMediatorStrategy().getError();</span>
        
        // Fix #36975: ArrayIndexOutOfBoundsException on getItem()
        // Fix #40352: NullPointerException on ?
        try {
<span class="nc bnc" id="L272" title="All 2 branches missed.">            for (var i = 0 ; i &lt; this.menuStrategy.getItemCount() ; i++) {</span>
<span class="nc bnc" id="L273" title="All 2 branches missed.">                if (this.menuStrategy.getItem(i).getText().equals(strategy.toString())) {</span>

<span class="nc" id="L275">                    ((JMenu) this.menuStrategy.getItem(i)).getItem(indexMethodError).setEnabled(false);</span>
<span class="nc" id="L276">                    break;</span>
                }
            }
<span class="nc" id="L279">        } catch (ArrayIndexOutOfBoundsException | NullPointerException e) {</span>
<span class="nc" id="L280">            LOGGER.log(LogLevelUtil.CONSOLE_JAVA, e, e);</span>
<span class="nc" id="L281">        }</span>
<span class="nc" id="L282">    }</span>
    
    public void markError() {

<span class="nc" id="L286">        StrategyInjectionError strategy = MediatorHelper.model().getMediatorStrategy().getError();</span>
<span class="nc" id="L287">        this.menuStrategy.setText(strategy.toString());</span>
        
<span class="nc" id="L289">        JMenu menuError = this.getMenuError();</span>
        
<span class="nc" id="L291">        int indexError = strategy.getIndexErrorStrategy();</span>
<span class="nc" id="L292">        String nameError = MediatorHelper.model().getMediatorVendor().getVendor().instance().getModelYaml().getStrategy().getError().getMethod().get(indexError).getName();</span>
        
<span class="nc bnc" id="L294" title="All 2 branches missed.">        for (var i = 0 ; i &lt; menuError.getItemCount() ; i++) {</span>
            // Fix #44635: ArrayIndexOutOfBoundsException on getItem()
            try {
<span class="nc bnc" id="L297" title="All 2 branches missed.">                if (menuError.getItem(i).getText().equals(nameError)) {</span>
                    
<span class="nc" id="L299">                    menuError.getItem(i).setSelected(true);</span>
<span class="nc" id="L300">                    this.menuStrategy.setText(nameError);</span>
                    
<span class="nc" id="L302">                    break;</span>
                }
<span class="nc" id="L304">            } catch (NullPointerException | ArrayIndexOutOfBoundsException e) {</span>
<span class="nc" id="L305">                LOGGER.log(LogLevelUtil.CONSOLE_JAVA, e, e);</span>
<span class="nc" id="L306">            }</span>
        }
<span class="nc" id="L308">    }</span>

    private JMenu getMenuError() {
        
<span class="fc" id="L312">        return (JMenu) Arrays.stream(this.menuStrategy.getMenuComponents())</span>
<span class="fc" id="L313">            .filter(c -&gt; ((JMenuItem) c).getText().equalsIgnoreCase(MediatorHelper.model().getMediatorStrategy().getError().getName()))</span>
<span class="fc" id="L314">            .findFirst()</span>
<span class="fc" id="L315">            .orElse(new JMenuItem(&quot;Mock&quot;));</span>
    }
    
    public void markErrorVulnerable(int indexMethodError) {
        
<span class="fc" id="L320">        AbstractStrategy strategy = MediatorHelper.model().getMediatorStrategy().getError();</span>
        
<span class="pc bpc" id="L322" title="1 of 2 branches missed.">        for (var i = 0 ; i &lt; this.menuStrategy.getItemCount() ; i++) {</span>
            
<span class="fc" id="L324">            JMenuItem menuItemStrategy = this.menuStrategy.getItem(i);</span>
            
<span class="fc bfc" id="L326" title="All 2 branches covered.">            if (menuItemStrategy.getText().equals(strategy.toString())) {</span>
                
<span class="fc" id="L328">                JMenu menuError = (JMenu) menuItemStrategy;</span>
<span class="fc" id="L329">                menuError.setEnabled(true);</span>
                
                // Fix #46578: ArrayIndexOutOfBoundsException on getItem()
<span class="pc bpc" id="L332" title="2 of 4 branches missed.">                if (0 &lt;= indexMethodError &amp;&amp; indexMethodError &lt; menuError.getItemCount()) {</span>
<span class="fc" id="L333">                    menuError.getItem(indexMethodError).setEnabled(true);</span>
                }
                
                break;
            }
        }
<span class="fc" id="L339">    }</span>
    
    public void markStrategyVulnerable(AbstractStrategy strategy) {
<span class="nc bnc" id="L342" title="All 2 branches missed.">        for (var i = 0 ; i &lt; this.menuStrategy.getItemCount() ; i++) {</span>
<span class="nc bnc" id="L343" title="All 2 branches missed.">            if (this.menuStrategy.getItem(i).getText().equals(strategy.toString())) {</span>
                
<span class="nc" id="L345">                this.menuStrategy.getItem(i).setEnabled(true);</span>
<span class="nc" id="L346">                break;</span>
            }
        }
<span class="nc" id="L349">    }</span>
    
    
    // Getter and setter

    public JLabel getLoader() {
<span class="fc" id="L355">        return this.loader;</span>
    }

    public ButtonAddressBar getButtonInUrl() {
<span class="fc" id="L359">        return this.buttonInUrl;</span>
    }
}
</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.8.12.202403310830</span></div></body></html>