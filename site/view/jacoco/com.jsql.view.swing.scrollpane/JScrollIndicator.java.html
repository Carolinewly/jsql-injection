<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang=""><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/><title>JScrollIndicator.java</title><link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">view</a> &gt; <a href="index.source.html" class="el_package">com.jsql.view.swing.scrollpane</a> &gt; <span class="el_source">JScrollIndicator.java</span></div><h1>JScrollIndicator.java</h1><pre class="source lang-java linenums">package com.jsql.view.swing.scrollpane;

import com.jsql.util.LogLevelUtil;
import org.apache.logging.log4j.LogManager;
import org.apache.logging.log4j.Logger;

import javax.swing.*;
import javax.swing.plaf.ScrollBarUI;
import javax.swing.plaf.basic.BasicScrollBarUI;
import java.awt.*;
import java.awt.event.ComponentAdapter;
import java.awt.event.ComponentEvent;
import java.awt.event.MouseAdapter;
import java.awt.event.MouseEvent;

/**
 * A scrollpane like component, where the scroll bars are floating over the
 * scrollable view to indicate the current scroll positions.
 * The scroll indicators appear smoothly during scroll events and disappear
 * smoothly afterward.
 * &lt;p&gt;
 * The scrollbars can be dragged just as normal.&lt;/p&gt;
 * &lt;p&gt;
 * The usage is similar to a classic scrollpane.&lt;/p&gt;
 *
 * @author Jolly Littlebottom
 */
public class JScrollIndicator extends JLayeredPane {
    
    /**
     * Log4j logger sent to view.
     */
<span class="fc" id="L33">    private static final Logger LOGGER = LogManager.getRootLogger();</span>

    private static final int SCROLL_BAR_ALPHA_ROLLOVER = 100;
    private static final int SCROLL_BAR_ALPHA = 25;

<span class="fc" id="L38">    private static final Color THUMB_COLOR = Color.DARK_GRAY;</span>
    private static final int THUMB_THICKNESS = 15;
    private static final int THUMB_MIN_SIZE = 48;
    private static final int THUMB_MARGIN = 0;

    private final JScrollPane scrollPane;
    private final ControlPanel controlPanel;

    /**
     * Creates a &lt;code&gt;JScrollIndicator&lt;/code&gt; that displays the contents of the
     * specified component, where both horizontal and vertical scrollbars appear
     * whenever the component's contents are larger than the view and scrolling
     * in underway or the mouse is over the scrollbar position.
     *
     * see #setViewportView
     * @param view the component to display in the scrollpane's viewport
     */
    public JScrollIndicator(final JComponent view) {
<span class="fc" id="L56">        this(view, ScrollPaneConstants.VERTICAL_SCROLLBAR_AS_NEEDED, ScrollPaneConstants.HORIZONTAL_SCROLLBAR_AS_NEEDED);</span>
<span class="fc" id="L57">    }</span>
    
    public JScrollIndicator(final JComponent view, int scrollPaneConstants) {
<span class="fc" id="L60">        this(view, ScrollPaneConstants.VERTICAL_SCROLLBAR_AS_NEEDED, scrollPaneConstants);</span>
<span class="fc" id="L61">    }</span>

    /**
     * Creates a &lt;code&gt;JScrollIndicator&lt;/code&gt; that displays the view component
     * in a viewport whose view position can be controlled with a pair of
     * scrollbars.
     * The scrollbar policies specify when the scrollbars are displayed,
     * For example, if &lt;code&gt;vsbPolicy&lt;/code&gt; is
     * &lt;code&gt;JScrollPane.VERTICAL_SCROLLBAR_AS_NEEDED&lt;/code&gt;
     * then the vertical scrollbar only appears if the view doesn't fit
     * vertically. The available policy settings are listed at
     * {link #JScrollPane.setVerticalScrollBarPolicy} and
     * {link #JScrollPane.setHorizontalScrollBarPolicy}.
     *
     * @param view the component to display in the scrollpanes viewport
     * @param vsbPolicy an integer that specifies the vertical scrollbar policy
     * @param hsbPolicy an integer that specifies the horizontal scrollbar policy
     */
<span class="fc" id="L79">    public JScrollIndicator(final JComponent view, int vsbPolicy, int hsbPolicy) {</span>
        
<span class="fc" id="L81">        this.scrollPane = new JScrollPane(view, vsbPolicy, hsbPolicy);</span>
<span class="fc" id="L82">        this.scrollPane.setBorder(BorderFactory.createEmptyBorder());</span>
<span class="fc" id="L83">        this.add(this.scrollPane, JLayeredPane.DEFAULT_LAYER);</span>

<span class="fc" id="L85">        this.controlPanel = new ControlPanel(this.scrollPane);</span>
<span class="fc" id="L86">        this.add(this.controlPanel, JLayeredPane.PALETTE_LAYER);</span>

<span class="fc" id="L88">        this.addComponentListener(</span>
<span class="fc" id="L89">            new ComponentAdapter() {</span>
                
                @Override
                public void componentResized(ComponentEvent e) {
                    
                    // listen to changes of JLayeredPane size
<span class="fc" id="L95">                    JScrollIndicator.this.scrollPane.setSize(JScrollIndicator.this.getSize());</span>
<span class="fc" id="L96">                    JScrollIndicator.this.scrollPane.getViewport().revalidate();</span>
<span class="fc" id="L97">                    JScrollIndicator.this.controlPanel.setSize(JScrollIndicator.this.getSize());</span>
<span class="fc" id="L98">                    JScrollIndicator.this.controlPanel.revalidate();</span>
<span class="fc" id="L99">                }</span>
            }
        );
<span class="fc" id="L102">    }</span>

    /**
     * Returns the scroll pane used by this scroll indicator.
     * Use carefully (e.g. to set unit increments) because not all changes have an
     * effect. You have to write listeners in these cases (e.g. for changing the
     * scrollbar policy)
     * 
     * @return
     */
    public JScrollPane getScrollPane() {
<span class="fc" id="L113">        return this.scrollPane;</span>
    }

    private class ControlPanel extends JPanel {

<span class="fc" id="L118">        private ControlPanel(JScrollPane scrollPane) {</span>
            
<span class="fc" id="L120">            this.setLayout(new BorderLayout());</span>
<span class="fc" id="L121">            this.setOpaque(false);</span>

<span class="fc" id="L123">            JMyScrollBar vScrollBar = new JMyScrollBar(Adjustable.VERTICAL);</span>
<span class="fc" id="L124">            scrollPane.setVerticalScrollBar(vScrollBar);</span>
<span class="fc" id="L125">            scrollPane.remove(vScrollBar);</span>
            
<span class="pc bpc" id="L127" title="1 of 2 branches missed.">            if (scrollPane.getVerticalScrollBarPolicy() != ScrollPaneConstants.VERTICAL_SCROLLBAR_NEVER) {</span>
<span class="fc" id="L128">                this.add(vScrollBar, BorderLayout.EAST);</span>
            }

<span class="fc" id="L131">            JMyScrollBar hScrollBar = new JMyScrollBar(Adjustable.HORIZONTAL);</span>
<span class="fc" id="L132">            scrollPane.setHorizontalScrollBar(hScrollBar);</span>
<span class="fc" id="L133">            scrollPane.remove(hScrollBar);</span>
            
<span class="fc bfc" id="L135" title="All 2 branches covered.">            if (scrollPane.getHorizontalScrollBarPolicy() != ScrollPaneConstants.HORIZONTAL_SCROLLBAR_NEVER) {</span>
<span class="fc" id="L136">                this.add(hScrollBar, BorderLayout.SOUTH);</span>
            }
<span class="fc" id="L138">        }</span>
    }

    private class JMyScrollBar extends JScrollBar {

        protected final transient MyScrollBarUI scrollUI;

<span class="fc" id="L145">        public JMyScrollBar(int direction) {</span>
            
<span class="fc" id="L147">            super(direction);</span>

<span class="fc" id="L149">            this.scrollUI = new MyScrollBarUI(this);</span>
<span class="fc" id="L150">            super.setUI(this.scrollUI);</span>
<span class="fc" id="L151">            this.setUnitIncrement(64);</span>
<span class="fc" id="L152">            int size = THUMB_THICKNESS + THUMB_MARGIN;</span>
<span class="fc" id="L153">            this.setPreferredSize(new Dimension(size, size));</span>
<span class="fc" id="L154">            this.scrollUI.setVisible();</span>
            
<span class="fc" id="L156">            this.addMouseListener(new MouseAdapter() {</span>
                
                @Override
                public void mouseEntered(MouseEvent e) {
<span class="nc" id="L160">                    JMyScrollBar.this.scrollUI.setVisible();</span>
<span class="nc" id="L161">                }</span>

                @Override
                public void mouseExited(MouseEvent e) {
<span class="nc" id="L165">                    JMyScrollBar.this.scrollUI.setVisible();</span>
<span class="nc" id="L166">                }</span>
            });

<span class="fc" id="L169">            this.addAdjustmentListener(adjustmentEvent -&gt; this.scrollUI.setVisible());</span>
<span class="fc" id="L170">        }</span>

        @Override
        public void setUI(ScrollBarUI ui) {
            // Nothing
<span class="nc" id="L175">        }</span>

        @Override
        public void updateUI() {
            // Nothing
<span class="fc" id="L180">        }</span>

        @Override
        public void paint(Graphics g) {
<span class="fc" id="L184">            this.scrollUI.paintThumb(g); // just the thumb</span>
<span class="fc" id="L185">        }</span>

        @Override
        public void repaint(Rectangle r) {
            
<span class="fc" id="L190">            JScrollIndicator scrollIndicator = JScrollIndicator.this;</span>
            
            // Fix #15956: NullPointerException on convertRectangle()
            try {
<span class="fc" id="L194">                var rect = SwingUtilities.convertRectangle(this, r, scrollIndicator);</span>
<span class="fc" id="L195">                rect.grow(1, 1);</span>
                // ensure for a translucent thumb, that the view is first painted
<span class="fc" id="L197">                scrollIndicator.repaint(rect);</span>
                
<span class="nc" id="L199">            } catch (NullPointerException e) {</span>
<span class="nc" id="L200">                LOGGER.log(LogLevelUtil.CONSOLE_JAVA, e, e);</span>
<span class="fc" id="L201">            }</span>
<span class="fc" id="L202">        }</span>
    }

    public class MyScrollBarUI extends BasicScrollBarUI {
        
        private final JMyScrollBar myScrollBar;
<span class="fc" id="L208">        private int alpha = 0;</span>

<span class="fc" id="L210">        private MyScrollBarUI(JMyScrollBar scrollBar) {</span>
<span class="fc" id="L211">            this.myScrollBar = scrollBar;</span>
<span class="fc" id="L212">        }</span>

        @Override
        protected void installComponents() {
            
<span class="fc" id="L217">            this.incrButton = new JButton();</span>
<span class="fc" id="L218">            this.decrButton = new JButton();</span>
            
<span class="fc bfc" id="L220" title="All 2 branches covered.">            if (this.myScrollBar.getOrientation() == Adjustable.HORIZONTAL) {</span>
                
<span class="fc" id="L222">                int size = THUMB_THICKNESS + THUMB_MARGIN; // let lower right corner empty</span>
<span class="fc" id="L223">                this.incrButton.setPreferredSize(new Dimension(size, size));</span>
                
<span class="fc" id="L225">            } else {</span>
<span class="fc" id="L226">                this.incrButton.setPreferredSize(new Dimension(THUMB_MARGIN, THUMB_MARGIN));</span>
            }
            
<span class="fc" id="L229">            this.decrButton.setPreferredSize(new Dimension(THUMB_MARGIN, THUMB_MARGIN));</span>
<span class="fc" id="L230">        }</span>

        @Override
        protected void installDefaults() {
            
<span class="fc" id="L235">            super.installDefaults();</span>

            // ensure the minimum size of the thumb
<span class="fc" id="L238">            int w = this.minimumThumbSize.width;</span>
<span class="fc" id="L239">            int h = this.minimumThumbSize.height;</span>
            
<span class="fc bfc" id="L241" title="All 2 branches covered.">            if (this.myScrollBar.getOrientation() == Adjustable.VERTICAL) {</span>
<span class="fc" id="L242">                h = Math.max(h, Math.min(this.maximumThumbSize.height, THUMB_MIN_SIZE));</span>
            } else {
<span class="fc" id="L244">                w = Math.max(w, Math.min(this.maximumThumbSize.width, THUMB_MIN_SIZE));</span>
            }
            
<span class="fc" id="L247">            this.minimumThumbSize = new Dimension(w, h);</span>
<span class="fc" id="L248">        }</span>

        private void paintThumb(Graphics g) {
            
<span class="pc bpc" id="L252" title="1 of 2 branches missed.">            int alphaThumb = this.isThumbRollover()</span>
<span class="nc" id="L253">                ? SCROLL_BAR_ALPHA_ROLLOVER</span>
<span class="fc" id="L254">                : SCROLL_BAR_ALPHA;</span>

<span class="fc" id="L256">            g.setColor(</span>
                new Color(
<span class="fc" id="L258">                    this.getAlphaColor().getRed(),</span>
<span class="fc" id="L259">                    this.getAlphaColor().getGreen(),</span>
<span class="fc" id="L260">                    this.getAlphaColor().getBlue(),</span>
                    alphaThumb
                )
            );
            
<span class="fc" id="L265">            Rectangle thumbBounds = this.getThumbBounds();</span>

<span class="fc" id="L267">            int x = thumbBounds.x;</span>
<span class="fc" id="L268">            int y = thumbBounds.y;</span>
<span class="fc" id="L269">            int w = thumbBounds.width;</span>
<span class="fc" id="L270">            int h = thumbBounds.height;</span>

<span class="fc bfc" id="L272" title="All 2 branches covered.">            if (this.myScrollBar.getOrientation() == Adjustable.VERTICAL) {</span>
<span class="fc" id="L273">                w -= THUMB_MARGIN;</span>
            } else {
<span class="fc" id="L275">                h -= THUMB_MARGIN;</span>
            }

<span class="fc" id="L278">            g.fillRect(x, y, w, h);</span>
<span class="fc" id="L279">        }</span>

        private Color getAlphaColor() {
            
<span class="pc bpc" id="L283" title="1 of 2 branches missed.">            if (this.alpha == 100) {</span>
<span class="nc" id="L284">                return JScrollIndicator.THUMB_COLOR;</span>
            }
            
<span class="fc" id="L287">            int rgb = JScrollIndicator.THUMB_COLOR.getRGB() &amp; 0xFFFFFF; // color without alpha values</span>
<span class="fc" id="L288">            rgb |= (this.alpha / 100 * 255) &lt;&lt; 24; // add alpha value</span>
            
<span class="fc" id="L290">            return new Color(rgb, true);</span>
        }

        public void setAlpha(int alpha) {
            
<span class="nc" id="L295">            this.alpha = alpha;</span>
<span class="nc" id="L296">            this.myScrollBar.repaint(this.getThumbBounds());</span>
<span class="nc" id="L297">        }</span>

        public void setVisible() {
<span class="fc" id="L300">            this.myScrollBar.repaint(this.getThumbBounds());</span>
<span class="fc" id="L301">        }</span>
    }
}
</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.8.12.202403310830</span></div></body></html>