<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/><title>PanelNode.java</title><link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">view</a> &gt; <a href="index.source.html" class="el_package">com.jsql.view.swing.tree</a> &gt; <span class="el_source">PanelNode.java</span></div><h1>PanelNode.java</h1><pre class="source lang-java linenums">/*******************************************************************************
 * Copyhacked (H) 2012-2020.
 * This program and the accompanying materials
 * are made available under no term at all, use it like
 * you want, but share and discuss about it
 * every time possible with every body.
 *
 * Contributors:
 *      ron190 at ymail dot com - initial implementation
 ******************************************************************************/
package com.jsql.view.swing.tree;

import com.jsql.util.I18nUtil;
import com.jsql.view.swing.tree.model.AbstractNodeModel;
import com.jsql.view.swing.util.UiStringUtil;
import com.jsql.view.swing.util.UiUtil;

import javax.swing.*;
import javax.swing.plaf.basic.BasicProgressBarUI;
import javax.swing.tree.DefaultMutableTreeNode;
import java.awt.*;
import java.awt.event.*;
import java.nio.charset.StandardCharsets;
import java.util.Objects;
import java.util.stream.Stream;

/**
 * A tree Node composed of an icon, a GIF loader, a progress bar, a label.
 */
public class PanelNode extends JPanel {
    
    /**
     * Default icon of the node (database or table).
     */
<span class="fc" id="L35">    private final JLabel icon = new JLabel();</span>

    /**
     * A GIF loader, displayed if progress track is unknown (like columns).
     */
<span class="fc" id="L40">    private final JLabel loader = new JLabel();</span>

    /**
     * Progress bar displayed during injection, with pause icon displayed if user paused the process.
     */
<span class="fc" id="L45">    private final ProgressBarPausable progressBar = new ProgressBarPausable();</span>

    /**
     * Text of the node.
     */
<span class="fc" id="L50">    private final JLabel label = new JLabel();</span>
<span class="fc" id="L51">    private final JTextField textFieldEditable = new JTextField(15);</span>
    
    /**
     * Create Panel for tree nodes.
     * @param tree JTree to populate
     * @param currentNode Node to draw in the tree
     */
<span class="fc" id="L58">    public PanelNode(final JTree tree, final DefaultMutableTreeNode currentNode) {</span>
        
<span class="fc" id="L60">        var animatedGIF = new ImageIcon(Objects.requireNonNull(PanelNode.class.getClassLoader().getResource(UiUtil.PATH_PROGRESSBAR)));</span>
<span class="fc" id="L61">        animatedGIF.setImageObserver(new ImageObserverAnimated(tree, currentNode));</span>
        
<span class="fc" id="L63">        this.loader.setIcon(animatedGIF);</span>
<span class="fc" id="L64">        this.loader.setBorder(BorderFactory.createEmptyBorder(2, 2, 2, 2));</span>

<span class="fc" id="L66">        this.progressBar.setPreferredSize(new Dimension(20, 20));</span>
<span class="fc" id="L67">        this.progressBar.setUI(new BasicProgressBarUI());</span>
<span class="fc" id="L68">        this.progressBar.setBorder(BorderFactory.createCompoundBorder(</span>
<span class="fc" id="L69">            BorderFactory.createEmptyBorder(4, 3, 4, 3),</span>
<span class="fc" id="L70">            BorderFactory.createCompoundBorder(</span>
<span class="fc" id="L71">                BorderFactory.createLineBorder(Color.GRAY),</span>
<span class="fc" id="L72">                BorderFactory.createLineBorder(Color.WHITE)</span>
            )
        ));
        
<span class="fc" id="L76">        this.label.setOpaque(true);</span>
<span class="fc" id="L77">        this.label.setBorder(UiUtil.BORDER_FOCUS_GAINED);</span>

<span class="fc" id="L79">        this.icon.setBorder(BorderFactory.createEmptyBorder(2, 2, 2, 2));</span>
        
<span class="fc" id="L81">        this.setBackground(Color.WHITE);</span>
<span class="fc" id="L82">        this.setLayout(new BoxLayout(this, BoxLayout.LINE_AXIS));</span>
        
<span class="fc" id="L84">        Stream.of(</span>
            this.icon,
            this.loader,
            this.progressBar,
            this.label,
            this.textFieldEditable
        )
<span class="fc" id="L91">        .forEach(component -&gt; {</span>
            
<span class="fc" id="L93">            this.add(component);</span>
<span class="fc" id="L94">            component.setVisible(false);</span>
<span class="fc" id="L95">        });</span>
        
<span class="fc" id="L97">        this.setComponentOrientation(ComponentOrientation.getOrientation(I18nUtil.getLocaleDefault()));</span>
        
<span class="fc" id="L99">        this.initializeTextFieldEditable(tree, currentNode);</span>

<span class="fc" id="L101">        this.addFocusListener(new FocusListener() {</span>
            
            @Override
            public void focusLost(FocusEvent e) {
                
<span class="nc" id="L106">                PanelNode.this.label.setBackground(UiUtil.COLOR_FOCUS_LOST);</span>
<span class="nc" id="L107">                PanelNode.this.label.setBorder(UiUtil.BORDER_FOCUS_LOST);</span>
<span class="nc" id="L108">            }</span>
            
            @Override
            public void focusGained(FocusEvent e) {
                
<span class="nc" id="L113">                PanelNode.this.label.setBackground(UiUtil.COLOR_FOCUS_GAINED);</span>
<span class="nc" id="L114">                PanelNode.this.label.setBorder(UiUtil.BORDER_FOCUS_GAINED);</span>
<span class="nc" id="L115">            }</span>
        });
<span class="fc" id="L117">    }</span>

    private void initializeTextFieldEditable(final JTree tree, final DefaultMutableTreeNode currentNode) {
        
<span class="fc" id="L121">        this.textFieldEditable.setFont(UiUtil.FONT_NON_MONO);</span>
<span class="fc" id="L122">        this.textFieldEditable.setBorder(BorderFactory.createLineBorder(UiUtil.COLOR_FOCUS_GAINED, 1, false));</span>
        
<span class="fc" id="L124">        this.textFieldEditable.addActionListener(e -&gt; {</span>
            
<span class="nc" id="L126">            AbstractNodeModel nodeModel = (AbstractNodeModel) currentNode.getUserObject();</span>
<span class="nc" id="L127">            nodeModel.setIsEdited(false);</span>
            
<span class="nc" id="L129">            this.label.setVisible(true);</span>
<span class="nc" id="L130">            this.textFieldEditable.setVisible(false);</span>
<span class="nc" id="L131">            tree.requestFocusInWindow();</span>
            
<span class="nc" id="L133">            nodeModel.getElementDatabase().setElementValue(new String(this.textFieldEditable.getText().getBytes(StandardCharsets.UTF_8)));</span>
<span class="nc" id="L134">            this.label.setText(UiStringUtil.detectUtf8Html(nodeModel.getElementDatabase().getLabelCount()));</span>
            
<span class="nc" id="L136">            tree.revalidate();</span>
<span class="nc" id="L137">            tree.repaint();</span>
<span class="nc" id="L138">        });</span>
        
<span class="fc" id="L140">        this.textFieldEditable.addFocusListener(new FocusAdapter() {</span>
            
            @Override
            public void focusLost(FocusEvent e) {
                
<span class="nc" id="L145">                AbstractNodeModel nodeModel = (AbstractNodeModel) currentNode.getUserObject();</span>
<span class="nc" id="L146">                nodeModel.setIsEdited(false);</span>
<span class="nc" id="L147">                tree.revalidate();</span>
<span class="nc" id="L148">                tree.repaint();</span>
<span class="nc" id="L149">            }</span>
        });
        
<span class="fc" id="L152">        KeyAdapter keyAdapterF2 = new KeyAdapter() {</span>
            
            @Override
            public void keyPressed(KeyEvent e) {
                
<span class="nc" id="L157">                AbstractNodeModel nodeModel = (AbstractNodeModel) currentNode.getUserObject();</span>
                
<span class="nc bnc" id="L159" title="All 4 branches missed.">                if (e.getKeyCode() == KeyEvent.VK_F2 &amp;&amp; !nodeModel.isRunning()) {</span>
                    
<span class="nc" id="L161">                    nodeModel.setIsEdited(true);</span>
                    
<span class="nc" id="L163">                    PanelNode.this.label.setVisible(false);</span>
<span class="nc" id="L164">                    PanelNode.this.textFieldEditable.setVisible(true);</span>
<span class="nc" id="L165">                    PanelNode.this.textFieldEditable.requestFocusInWindow();</span>
                    
<span class="nc" id="L167">                    tree.revalidate();</span>
<span class="nc" id="L168">                    tree.repaint();</span>
                }
<span class="nc" id="L170">            }</span>
        };
        
<span class="fc" id="L173">        this.addKeyListener(keyAdapterF2);</span>
<span class="fc" id="L174">        this.textFieldEditable.addKeyListener(keyAdapterF2);</span>
<span class="fc" id="L175">    }</span>

    /**
     * Change the text icon.
     * @param newIcon An icon to display next to the text.
     */
    public void setIcon(Icon newIcon) {
<span class="fc" id="L182">        this.icon.setIcon(newIcon);</span>
<span class="fc" id="L183">    }</span>
    
    /**
     * Display the normal text icon to the left.
     */
    public void showIcon() {
<span class="fc" id="L189">        this.icon.setVisible(true);</span>
<span class="fc" id="L190">    }</span>
    
    /**
     * Mask the node icon for example when the loader component is displayed.
     */
    public void hideIcon() {
<span class="nc" id="L196">        this.icon.setVisible(false);</span>
<span class="nc" id="L197">    }</span>
    
    /**
     * Change the loader icon.
     * @param newIcon An icon to display for the loader.
     */
    public void setLoaderIcon(Icon newIcon) {
<span class="nc" id="L204">        this.loader.setIcon(newIcon);</span>
<span class="nc" id="L205">    }</span>

    /**
     * Display the animated gif loader.
     */
    public void showLoader() {
<span class="nc" id="L211">        this.loader.setVisible(true);</span>
<span class="nc" id="L212">    }</span>
    
    
    // Getter and setter

    public ProgressBarPausable getProgressBar() {
<span class="nc" id="L218">        return this.progressBar;</span>
    }

    public JLabel getLabel() {
<span class="fc" id="L222">        return this.label;</span>
    }

    public JTextField getEditable() {
<span class="fc" id="L226">        return this.textFieldEditable;</span>
    }
}
</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.8.11.202310140853</span></div></body></html>