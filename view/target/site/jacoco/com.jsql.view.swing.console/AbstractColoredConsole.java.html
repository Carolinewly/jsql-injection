<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/><title>AbstractColoredConsole.java</title><link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">view</a> &gt; <a href="index.source.html" class="el_package">com.jsql.view.swing.console</a> &gt; <span class="el_source">AbstractColoredConsole.java</span></div><h1>AbstractColoredConsole.java</h1><pre class="source lang-java linenums">package com.jsql.view.swing.console;

import com.jsql.util.LogLevelUtil;
import com.jsql.view.swing.text.JPopupTextPane;
import com.jsql.view.swing.util.MediatorHelper;
import com.jsql.view.swing.util.UiUtil;
import org.apache.commons.lang3.StringUtils;
import org.apache.logging.log4j.LogManager;
import org.apache.logging.log4j.Logger;

import javax.swing.*;
import javax.swing.text.SimpleAttributeSet;
import java.awt.*;
import java.awt.event.FocusAdapter;
import java.awt.event.FocusEvent;

/**
 * A JTextPane which displays colored strings.
 */
public abstract class AbstractColoredConsole extends JPopupTextPane {
    
    /**
     * Log4j logger sent to view.
     */
<span class="fc" id="L25">    private static final Logger LOGGER = LogManager.getRootLogger();</span>

    /**
     * Text name of tab.
     */
    private final String tabName;

    /**
     * Create a JTextPane which displays colored strings.
     * @param tabName Text name of tab
     */
    protected AbstractColoredConsole(final String tabName, String placeholder) {
        
<span class="fc" id="L38">        super(placeholder);</span>
        
<span class="fc" id="L40">        this.tabName = tabName;</span>
        
<span class="fc" id="L42">        this.addFocusListener(new FocusAdapter() {</span>
            
            @Override
            public void focusGained(FocusEvent arg0) {
                
<span class="nc" id="L47">                AbstractColoredConsole.this.getProxy().getCaret().setVisible(true);</span>
<span class="nc" id="L48">                AbstractColoredConsole.this.getProxy().getCaret().setSelectionVisible(true);</span>
<span class="nc" id="L49">            }</span>
        });

<span class="fc" id="L52">        this.setCursor(Cursor.getPredefinedCursor(Cursor.TEXT_CURSOR));</span>
<span class="fc" id="L53">    }</span>
    
    protected abstract SimpleAttributeSet getColorAttribute();

    /**
     * Add a string to the end of JTextPane.
     * @param message Text to add
     * @param attribut Font
     */
    public void append(String message, SimpleAttributeSet attribut) {
        
        try {
<span class="pc bpc" id="L65" title="1 of 2 branches missed.">            boolean isCaretAtEnd = this.getProxy().getCaretPosition() == this.getProxy().getDocument().getLength();</span>
            
<span class="fc" id="L67">            JScrollPane scrollPane = (JScrollPane) this.getProxy().getParent().getParent();</span>
<span class="fc" id="L68">            JScrollBar scrollBar = scrollPane.getVerticalScrollBar();</span>
<span class="fc" id="L69">            int extent = scrollBar.getModel().getExtent();</span>
<span class="pc bpc" id="L70" title="1 of 2 branches missed.">            boolean isScrollBarAtEnd = scrollBar.getValue() &gt;= scrollBar.getMaximum() - extent;</span>
            
<span class="fc" id="L72">            var logMessage = message.substring(15);</span>
<span class="fc" id="L73">            var logTimestamp = message.substring(0, 15);</span>
            
<span class="fc" id="L75">            this.getProxy().getDocument().insertString(</span>
<span class="fc" id="L76">                this.getProxy().getDocument().getLength(),</span>
<span class="fc bfc" id="L77" title="All 2 branches covered.">                (this.getProxy().getDocument().getLength() == 0 ? StringUtils.EMPTY : &quot;\n&quot;) + logTimestamp,</span>
<span class="fc" id="L78">                this.getColorAttribute()</span>
            );
            
<span class="fc" id="L81">            this.getProxy().getDocument().insertString(</span>
<span class="fc" id="L82">                this.getProxy().getDocument().getLength(),</span>
                logMessage,
                attribut
            );
            
<span class="pc bpc" id="L87" title="3 of 4 branches missed.">            if (isCaretAtEnd || isScrollBarAtEnd) {</span>
                
<span class="fc" id="L89">                scrollBar.setValue(scrollBar.getMaximum() + 1);</span>
            }

<span class="fc" id="L92">            var foregroundColor = Color.BLACK;</span>
            
<span class="fc bfc" id="L94" title="All 2 branches covered.">            if (attribut == JTextPaneAppender.ATTRIBUTE_WARN) {</span>
                
<span class="fc" id="L96">                foregroundColor = Color.RED;</span>
                
<span class="pc bpc" id="L98" title="1 of 2 branches missed.">            } else if (attribut == JTextPaneAppender.ATTRIBUTE_SUCCESS) {</span>
                
<span class="nc" id="L100">                foregroundColor = UiUtil.COLOR_GREEN;</span>
            }
            
<span class="fc" id="L103">            int tabIndex = MediatorHelper.tabConsoles().indexOfTab(this.tabName);</span>
            
<span class="pc bpc" id="L105" title="2 of 4 branches missed.">            if (0 &lt;= tabIndex &amp;&amp; tabIndex &lt; MediatorHelper.tabConsoles().getTabCount()) {</span>
                
<span class="fc" id="L107">                var tabHeader = MediatorHelper.tabConsoles().getTabComponentAt(tabIndex);</span>
                
<span class="fc bfc" id="L109" title="All 2 branches covered.">                if (MediatorHelper.tabConsoles().getSelectedIndex() != tabIndex) {</span>
                    
<span class="fc" id="L111">                    tabHeader.setFont(tabHeader.getFont().deriveFont(Font.BOLD));</span>

<span class="fc bfc" id="L113" title="All 2 branches covered.">                    if (foregroundColor != Color.BLACK) {  // keep tab colored until user clicks</span>

<span class="fc" id="L115">                        tabHeader.setForeground(foregroundColor);</span>
                    }
                }
            }
            
<span class="fc" id="L120">        } catch (Exception e) {</span>
            
            // Report #863: exception during report of exception
<span class="fc" id="L123">            LOGGER.log(LogLevelUtil.CONSOLE_DEFAULT, message, e);</span>
<span class="fc" id="L124">        }</span>
<span class="fc" id="L125">    }</span>
}
</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.8.11.202310140853</span></div></body></html>